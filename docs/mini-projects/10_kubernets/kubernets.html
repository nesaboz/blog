<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-03-03">
<meta name="description" content="On Linode Kubernets Engine (LKE)">

<title>Nenad Bozinovic - Kubernets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Nenad Bozinovic - Kubernets">
<meta property="og:description" content="On Linode Kubernets Engine (LKE)">
<meta property="og:image" content="www.nenadbozinovic.com/mini-projects/10_kubernets/thumbnail.png">
<meta property="og:site-name" content="Nenad Bozinovic">
<meta property="og:image:height" content="652">
<meta property="og:image:width" content="1814">
<meta name="twitter:title" content="Nenad Bozinovic - Kubernets">
<meta name="twitter:description" content="On Linode Kubernets Engine (LKE)">
<meta name="twitter:image" content="www.nenadbozinovic.com/mini-projects/10_kubernets/thumbnail.png">
<meta name="twitter:image-height" content="652">
<meta name="twitter:image-width" content="1814">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Nenad Bozinovic</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../projects.html" aria-current="page">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../mini-projects.html">
 <span class="menu-text">Mini-projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tips.html">
 <span class="menu-text">Tips</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../media.html">
 <span class="menu-text">Media</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About me</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/nesaboz"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/nesaboz"><i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/nenadbozinovic/"><i class="bi bi-linkedin" role="img" aria-label="Linkedin">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Kubernets</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../projects.html" class="sidebar-item-text sidebar-link">Projects</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../projects/solar/solar.html" class="sidebar-item-text sidebar-link">Solar</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../mini-projects.html" class="sidebar-item-text sidebar-link">Mini-projects</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mini-projects/15_head_pose/head_pose.html" class="sidebar-item-text sidebar-link">Image Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mini-projects/14_multi_label_classification/multi_label_classification.html" class="sidebar-item-text sidebar-link">Multi-label classification</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mini-projects/13_fastbook_chapter_5_image_classification/fastbook_chapter_5_image_classification.html" class="sidebar-item-text sidebar-link">Pet Breed Classification</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mini-projects/10_kubernets/kubernets.html" class="sidebar-item-text sidebar-link active">Kubernets</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mini-projects/09_bear_classifier/bear_classifier.html" class="sidebar-item-text sidebar-link">Bear classifier</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mini-projects/labeling.html" class="sidebar-item-text sidebar-link">Labeling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mini-projects/transfer_learning.html" class="sidebar-item-text sidebar-link">Transfer learning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mini-projects/rock_paper_scissors.html" class="sidebar-item-text sidebar-link">Rock paper scissors</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mini-projects/multiclass_image_classification.html" class="sidebar-item-text sidebar-link">Multiclass image classification</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mini-projects/2_torchvision_conversions_samplers.html" class="sidebar-item-text sidebar-link">Torchvision, Conversions, Samplers</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mini-projects/1_binary_image_classification.html" class="sidebar-item-text sidebar-link">Binary image classification</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mini-projects/binary_classification.html" class="sidebar-item-text sidebar-link">Binary Classification</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mini-projects/quadratic_function_fit.html" class="sidebar-item-text sidebar-link">Quadratic function fitting</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mini-projects/linear_regression.html" class="sidebar-item-text sidebar-link">Linear Regression</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../tips.html" class="sidebar-item-text sidebar-link">Tips</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">Python</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/010_Python/datetime.html" class="sidebar-item-text sidebar-link">Datetime</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/010_Python/fileio.html" class="sidebar-item-text sidebar-link">FileIO</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/010_Python/functools.html" class="sidebar-item-text sidebar-link">Functools</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/010_Python/pathlib.html" class="sidebar-item-text sidebar-link">Pathlib</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/010_Python/pil.html" class="sidebar-item-text sidebar-link">PIL</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/010_Python/pytest.html" class="sidebar-item-text sidebar-link">PyTest</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/010_Python/regex.html" class="sidebar-item-text sidebar-link">Regex</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/010_Python/numpy.html" class="sidebar-item-text sidebar-link">Numpy</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/010_Python/pydata.html" class="sidebar-item-text sidebar-link">PyData</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/010_Python/setoperations.html" class="sidebar-item-text sidebar-link">Set operations</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/010_Python/visualizations.html" class="sidebar-item-text sidebar-link">Visualizations</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/010_Python/general.html" class="sidebar-item-text sidebar-link">Python General</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">Jupyter</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/020_Jupyter/images.html" class="sidebar-item-text sidebar-link">Images</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/020_Jupyter/kernels.html" class="sidebar-item-text sidebar-link">Kernels</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/020_Jupyter/general.html" class="sidebar-item-text sidebar-link">Jupyter General</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/020_Jupyter/matplotlib.html" class="sidebar-item-text sidebar-link">Matplotlib</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">Terminal</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/030_Terminal/setupenv.html" class="sidebar-item-text sidebar-link">Set up env</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/030_Terminal/zsh.html" class="sidebar-item-text sidebar-link">zsh</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">PyTorch</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/040_PyTorch/augmentations.html" class="sidebar-item-text sidebar-link">Augmentations</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/040_PyTorch/convolutions.html" class="sidebar-item-text sidebar-link">Convolutions</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/040_PyTorch/loss.html" class="sidebar-item-text sidebar-link">Loss</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/040_PyTorch/metrics.html" class="sidebar-item-text sidebar-link">Metrics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/040_PyTorch/models.html" class="sidebar-item-text sidebar-link">Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/040_PyTorch/tensor.html" class="sidebar-item-text sidebar-link">Tensor</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">FastAI</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/050_FastAI/azure.html" class="sidebar-item-text sidebar-link">Azure</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/050_FastAI/fastai.html" class="sidebar-item-text sidebar-link">FastAI</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/050_FastAI/huggingface.html" class="sidebar-item-text sidebar-link">HuggingFace</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/050_FastAI/nbdev.html" class="sidebar-item-text sidebar-link">nbdev</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">Misc</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/060_Misc/git.html" class="sidebar-item-text sidebar-link">Git</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/060_Misc/paperspace.html" class="sidebar-item-text sidebar-link">Paperspace.com</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/060_Misc/jarvislabsai.html" class="sidebar-item-text sidebar-link">Jarvislabs.ai</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/060_Misc/latex.html" class="sidebar-item-text sidebar-link">Latex</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/060_Misc/macos.html" class="sidebar-item-text sidebar-link">MacOS</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/060_Misc/customdomain.html" class="sidebar-item-text sidebar-link">Custom domain</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tips/060_Misc/kaggle.html" class="sidebar-item-text sidebar-link">Kaggle</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../media.html" class="sidebar-item-text sidebar-link">Media</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../about.html" class="sidebar-item-text sidebar-link">About me</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#containerize-an-app-via-docker" id="toc-containerize-an-app-via-docker" class="nav-link active" data-scroll-target="#containerize-an-app-via-docker">Containerize an App (via Docker)</a></li>
  <li><a href="#register-images-via-dockerhub" id="toc-register-images-via-dockerhub" class="nav-link" data-scroll-target="#register-images-via-dockerhub">Register Images (via DockerHub)</a></li>
  <li><a href="#set-up-hosted-kubernets-via-linode-kubernets-engine-aka-lke" id="toc-set-up-hosted-kubernets-via-linode-kubernets-engine-aka-lke" class="nav-link" data-scroll-target="#set-up-hosted-kubernets-via-linode-kubernets-engine-aka-lke">Set up Hosted Kubernets (via Linode Kubernets Engine aka LKE)</a></li>
  <li><a href="#connect-to-lke" id="toc-connect-to-lke" class="nav-link" data-scroll-target="#connect-to-lke">Connect to LKE</a></li>
  <li><a href="#kubectl" id="toc-kubectl" class="nav-link" data-scroll-target="#kubectl"><code>kubectl</code></a></li>
  <li><a href="#pod-object" id="toc-pod-object" class="nav-link" data-scroll-target="#pod-object">Pod object</a></li>
  <li><a href="#kubernets-service-controller" id="toc-kubernets-service-controller" class="nav-link" data-scroll-target="#kubernets-service-controller">Kubernets Service controller</a></li>
  <li><a href="#kubernets-deployment-controller" id="toc-kubernets-deployment-controller" class="nav-link" data-scroll-target="#kubernets-deployment-controller">Kubernets Deployment controller</a></li>
  <li><a href="#rolling-update" id="toc-rolling-update" class="nav-link" data-scroll-target="#rolling-update">Rolling update</a></li>
  <li><a href="#appendix-apply-service-locally" id="toc-appendix-apply-service-locally" class="nav-link" data-scroll-target="#appendix-apply-service-locally">Appendix: Apply service locally</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/nesaboz/blog/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Kubernets</h1>
</div>

<div>
  <div class="description">
    On Linode Kubernets Engine (LKE)
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 3, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<p>The goal is to host cloud-native application that must:</p>
<ul>
<li>Scale on demand</li>
<li>Self-heal</li>
<li>Support zero-downtime rolling updates</li>
<li>Run anywhere (in cloud or non-cloud, like Raspberry PI).</li>
</ul>
<p>Kubernets allows all of this. It is an orchestrator that bring together a set of microservices and organizes them into an application that brings value.</p>
<p>Kubernets emerged in 2014 (from Google) as a way to abstract underlying cloud and server infrastructure. It commoditized infrastructure making and becoming <em>“OS of the cloud”</em>.</p>
<ul>
<li>A Kubernetes <strong>cluster</strong> consists of one or more machines that have Kubernetes installed on them.</li>
<li>Machines in a Kubernetes cluster are referred to as Nodes, but there are Master Nodes (<strong>Masters</strong>) and Worker Nodes (<strong>Nodes</strong>).</li>
<li>Worker nodes run user applications and can either be Linux or Windows Nodes.</li>
<li>All Nodes run two main services: <code>kubelet</code> and Container runtime.</li>
<li>The <code>kubelet</code> is the main Kubernetes agent. It joins the Node to the cluster and communicates with the control plane, in charge of notifying when tasks are received and reporting on the status of those tasks.</li>
<li>The container runtime starts and stops containers.</li>
<li>Hosted Kubernetes is where your cloud provider rents you a Kubernetes cluster. Sometimes, it is called Kubernetes as a Service, where we don’t have to worry about Masters, just Nodes. There are many hosted Kubernets services: AWS: Elastic Kubernetes Service (EKS), Azure: Azure Kubernetes Service (AKS), DO: Digital Ocean Kubernetes Service (DOKS), GCP: Google Kubernetes Engine (GKE), Linode: Linode Kubernetes Engine (LKE). I’ll use LKE here.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="10_kubernets_files/figure-html/35bbbfd3-1-image.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="10_kubernets_files/figure-html/5bc27199-1-image.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<section id="containerize-an-app-via-docker" class="level1">
<h1>Containerize an App (via Docker)</h1>
<p>First we want our App to be containerized. It has a few files:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>cd <span class="op">/</span>Users<span class="op">/</span>nenad.bozinovic<span class="op">/</span>Work<span class="op">/</span>blog<span class="op">/</span>nbs<span class="op">/</span>mini<span class="op">-</span>projects<span class="op">/</span><span class="dv">10</span><span class="er">_kubernets</span><span class="op">/</span>usercode</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/nenad.bozinovic/Work/blog/nbs/mini-projects/10_kubernets/usercode</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>ls App</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dockerfile    app.js        bootstrap.css package.json  views</code></pre>
</div>
</div>
<ul>
<li><code>Dockerfile</code>: This file is not part of the application. It contains a list of instructions that Docker executes to create the container image (i.e.&nbsp;containerize the application).</li>
<li><code>app.js</code>: This is the main application file. It is a Node.js application.</li>
<li><code>bootstrap.css</code>: This is a stylesheet template, which determines how the application’s web page will look.</li>
<li><code>package.json</code>: This lists the application dependencies.</li>
<li><code>views</code>: This is a folder that contains the HTML used to populate the application’s web page.</li>
</ul>
<p>Docker file contains following:</p>
<pre><code>FROM node:current-slim
COPY . /src
RUN cd /src; npm install
EXPOSE 8080
CMD cd /src &amp;&amp; node ./app.js</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>docker <span class="op">--</span>version</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Docker version 20.10.23, build 7155243</code></pre>
</div>
</div>
<p>We’ll now build two docker images called qsk-course version 1.0 and 1.1 under my local account (<code>nesaboz</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!docker image build -t nesaboz/qsk-course:1.0 App/.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Modify the App to create a new version and build version 1.1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!docker image build -t nesaboz/qsk-course:1.1 .`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see the <code>nesaboz/qsk-course</code> image now in the list of docker images:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>docker image ls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>REPOSITORY                  TAG       IMAGE ID       CREATED        SIZE
nesaboz/qsk-course          1.0       8d9065c8c75f   2 hours ago    268MB
nesaboz/qsk-course          1.1       60932818191e   5 hours ago    268MB
nesaboz/docker101tutorial   latest    940714c42b63   2 days ago     47MB
alpine/git                  latest    22d84a66cda4   3 months ago   43.6MB</code></pre>
</div>
</div>
<p>We can now actually run the application locally by running:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!docker run -dp 8080 nesaboz/qsk-course:1.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Docker will assign some port (can be seen in Docker Desktop), and our app will be running locally in a browser:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="10_kubernets_files/figure-html/e500c8e3-1-image.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<p>We can also run version 1.1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># !docker run -dp 8080 nesaboz/qsk-course:1.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="10_kubernets_files/figure-html/ee603306-1-image.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
</section>
<section id="register-images-via-dockerhub" class="level1">
<h1>Register Images (via DockerHub)</h1>
<p>Running locally is fine but we want to run in a cloud. There are many hosting services for containers, DockerHub is the easiest to use. We can push container to DockerHub by running the following (in Terminal since it requires password):</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> login <span class="at">--username</span> nesaboz</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> image push nesaboz/qsk-course:1.0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And we can see now that we have two verions on the <a href="https://hub.docker.com/repository/docker/nesaboz/qsk-course/general">DockerHub</a>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="10_kubernets_files/figure-html/1bb0f9ce-1-image-2.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image-2.png</figcaption><p></p>
</figure>
</div>
</section>
<section id="set-up-hosted-kubernets-via-linode-kubernets-engine-aka-lke" class="level1">
<h1>Set up Hosted Kubernets (via Linode Kubernets Engine aka LKE)</h1>
<p>LKE (<a href="https://cloud.linode.com/">https://cloud.linode.com/</a>) is a paid service to host Kubernets by setting a cluster of machines (we’ll use shared, CPU-only VMs). Once we set up a cluster, we can download a config file (aka kubeconfig file) that looks like this:</p>
<pre><code>apiVersion: v1
kind: Config
preferences: {}

clusters:
- cluster:
    certificate-authority-data: LS0tLS1CR...
    server: https://8c292154-27de-4e91-a129-fcb2a1614fee.us-west-1.linodelke.net:443
  name: lke95373

users:
- name: lke95373-admin
  user:
    as-user-extra: {}
    token: eyJhbGc...

contexts:
- context:
    cluster: lke95373
    namespace: default
    user: lke95373-admin
  name: lke95373-ctx

current-context: lke95373-ctx</code></pre>
</section>
<section id="connect-to-lke" class="level1">
<h1>Connect to LKE</h1>
<p>We can now activate nodes:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">KUBECONFIG</span><span class="op">=</span>/usercode/config    <span class="op">&lt;</span>== path might be different, for example KUBECONFIG=config</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get nodes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>NAME                           STATUS   ROLES    AGE   VERSION
lke95373-144188-63fe9e5739a9   Ready    &lt;none&gt;   22h   v1.25.4
lke95373-144188-63fe9e576608   Ready    &lt;none&gt;   22h   v1.25.4</code></pre>
<p>The nodes are now running.</p>
</section>
<section id="kubectl" class="level1">
<h1><code>kubectl</code></h1>
<p>Main command that executes everything kubernets is <code>kubectl</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> version <span class="at">-o</span> yaml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>clientVersion:
  buildDate: "2022-11-09T13:36:36Z"
  compiler: gc
  gitCommit: 872a965c6c6526caa949f0c6ac028ef7aff3fb78
  gitTreeState: clean
  gitVersion: v1.25.4
  goVersion: go1.19.3
  major: "1"
  minor: "25"
  platform: darwin/amd64
kustomizeVersion: v4.5.7
serverVersion:
  buildDate: "2023-01-18T19:15:26Z"
  compiler: gc
  gitCommit: ff2c119726cc1f8926fb0585c74b25921e866a28
  gitTreeState: clean
  gitVersion: v1.25.6
  goVersion: go1.19.5
  major: "1"
  minor: "25"
  platform: linux/amd64</code></pre>
</section>
<section id="pod-object" class="level1">
<h1>Pod object</h1>
<p>Pod is a lightweight wrapper for Docker image we already deployed on DockerHub. The config file for Pod is <code>pod.yml</code>:</p>
<pre><code>apiVersion: v1
kind: Pod
metadata:
  name: first-pod
  labels:
    project: qsk-course
spec:
  containers:
    - name: web-ctr
      image: nesaboz/qsk-course:1.0
      ports:
        - containerPort: 8080</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> pod.yml</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>NAME        READY   STATUS    RESTARTS   AGE
first-pod   1/1     Running   0          3m36s</code></pre>
<p>We can run similar though more detailed command (doesn’t run here in notebook):</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> describe pod first-pod</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To delete pods:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> delete pod first-pod</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> delete <span class="at">--all</span> pods</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="kubernets-service-controller" class="level1">
<h1>Kubernets Service controller</h1>
<p>Service controller provides connectivity to the application running in the Pod i.e.&nbsp;provisions an internet-facing load balancer. To do that we use <code>svc-cloud.yml</code> file that contains following:</p>
<pre><code>apiVersion: v1
kind: Service
metadata:
  name: cloud-lb
spec:
  type: LoadBalancer
  ports:
  - port: 8080
    targetPort: 8080
  selector:
    project: qsk-course    &lt;- this name must match pod.metadata.labels.project above</code></pre>
<p><strong>Note that <code>spec.selector.project</code> must match the <code>pod.metadata.labels.project</code></strong></p>
<p>(We also have an option of running <code>svc-local.yml</code> skipping that for now)</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> svc-cloud.yml   <span class="co">#  service/cloud-lb created`</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get svc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>qsk-cloud    LoadBalancer   10.128.141.64   45.79.230.110   8080:32026/TCP   13s</code></pre>
<p>or for more details run:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> describe svc cloud-lb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>now go to the <code>45.79.230.110:8080</code> address in your browser:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="10_kubernets_files/figure-html/431b1f6a-1-image.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<p>To delete svc object:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> delete svc cloud-lb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="kubernets-deployment-controller" class="level1">
<h1>Kubernets Deployment controller</h1>
<p>Deployment service provides self-healing, enable scaling, and rolling updates. The file <code>deploy.yml</code> looks like this:</p>
<pre><code>kind: Deployment                   &lt;&lt;== Type of object being defined
apiVersion: apps/v1                &lt;&lt;== Version of object specification
metadata:
  name: qsk-deploy
spec:
  replicas: 5                      &lt;&lt;== How many Pod replicas
  selector:
    matchLabels:                   &lt;&lt;== Tells the Deployment controller
      project: qsk-course            &lt;&lt;== which Pods to manage, must match svc.spec.selector.project above
  template:
    metadata:
      labels:
        project: qsk-course          &lt;&lt;== Pod label, must match svc.spec.selector.project above
    spec:
      containers:
      - name: qsk-pod
        imagePullPolicy: Always           &lt;&lt;== Never use local images
        ports:
        - containerPort: 8080             &lt;&lt;== Network port
        image: nesaboz/qsk-course:1.0     &lt;&lt;== Image containing the app</code></pre>
<p><strong>Note that <code>spec.template.labels.project</code> must match the <code>svc.spec.selector.project</code></strong></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> deploy.yml</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get deployments</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>NAME         READY   UP-TO-DATE   AVAILABLE   AGE
qsk-deploy   3/5     5            3           3s</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>NAME                          READY   STATUS    RESTARTS   AGE
qsk-deploy-767d99b5c7-5v9vs   1/1     Running   0          52s
qsk-deploy-767d99b5c7-9h67b   1/1     Running   0          52s
qsk-deploy-767d99b5c7-dpsk9   1/1     Running   0          52s
qsk-deploy-767d99b5c7-lwxcf   1/1     Running   0          52s
qsk-deploy-767d99b5c7-wh2rh   1/1     Running   0          52s</code></pre>
<p>If we delete one pod, for example first one <code>qsk-deploy-767d99b5c7-5v9vs</code>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> delete pod qsk-deploy-767d99b5c7-5v9vs</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>NAME                          READY   STATUS        RESTARTS   AGE
qsk-deploy-767d99b5c7-4vdjs   1/1     Running       0          13s
qsk-deploy-767d99b5c7-5v9vs   1/1     Terminating   0          3m19s
qsk-deploy-767d99b5c7-9h67b   1/1     Running       0          3m19s
qsk-deploy-767d99b5c7-dpsk9   1/1     Running       0          3m19s
qsk-deploy-767d99b5c7-lwxcf   1/1     Running       0          3m19s
qsk-deploy-767d99b5c7-wh2rh   1/1     Running       0          3m19s</code></pre>
<p>we see that new one gets running immediately, demonstrating self-healing.</p>
<p>We can also see that pods are running on both nodes (<code>lke...a9</code> and <code>lke...08</code>):</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="va">$kubectl</span> get pods <span class="at">-o</span> wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>NAME                          READY   STATUS    RESTARTS   AGE     IP         NODE                           NOMINATED NODE   READINESS GATES
qsk-deploy-767d99b5c7-4vdjs   1/1     Running   0          2m50s   10.2.1.7   lke95373-144188-63fe9e5739a9   &lt;none&gt;           &lt;none&gt;
qsk-deploy-767d99b5c7-9h67b   1/1     Running   0          5m56s   10.2.0.7   lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;
qsk-deploy-767d99b5c7-dpsk9   1/1     Running   0          5m56s   10.2.1.6   lke95373-144188-63fe9e5739a9   &lt;none&gt;           &lt;none&gt;
qsk-deploy-767d99b5c7-lwxcf   1/1     Running   0          5m56s   10.2.1.4   lke95373-144188-63fe9e5739a9   &lt;none&gt;           &lt;none&gt;
qsk-deploy-767d99b5c7-wh2rh   1/1     Running   0          5m56s   10.2.0.6   lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;
</code></pre>
<p>If we delete a node (in a LKE Cloud Console) then we can see that new pods will be created on a available node:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get nodes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>NAME                           STATUS   ROLES    AGE   VERSION
lke95373-144188-63fe9e576608   Ready    &lt;none&gt;   23h   v1.25.4</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">-o</span> wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>NAME                          READY   STATUS    RESTARTS   AGE    IP          NODE                           NOMINATED NODE   READINESS GATES
qsk-deploy-767d99b5c7-2qmgn   1/1     Running   0          105s   10.2.0.8    lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;
qsk-deploy-767d99b5c7-9h67b   1/1     Running   0          13m    10.2.0.7    lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;
qsk-deploy-767d99b5c7-f6k76   1/1     Running   0          104s   10.2.0.10   lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;
qsk-deploy-767d99b5c7-vsvgv   1/1     Running   0          104s   10.2.0.9    lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;
qsk-deploy-767d99b5c7-wh2rh   1/1     Running   0          13m    10.2.0.6    lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;</code></pre>
<p>We can see that old pods (<code>qsk-deploy...9h67b</code> and <code>qsk-deploy...wh2rh</code>) are still running, the other 3 are new (created 105 seconds ago). If we had set the Autoscale Pool on LKE, then the node will recover eventually:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="10_kubernets_files/figure-html/bfe8bf7e-1-image.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image.png</figcaption><p></p>
</figure>
</div>
<p>but the pods will still run only on one (<code>lke...08</code>) node:</p>
<pre><code>NAME                          READY   STATUS    RESTARTS   AGE   IP          NODE                           NOMINATED NODE   READINESS GATES
qsk-deploy-767d99b5c7-2qmgn   1/1     Running   0          20m   10.2.0.8    lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;
qsk-deploy-767d99b5c7-9h67b   1/1     Running   0          32m   10.2.0.7    lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;
qsk-deploy-767d99b5c7-f6k76   1/1     Running   0          20m   10.2.0.10   lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;
qsk-deploy-767d99b5c7-vsvgv   1/1     Running   0          20m   10.2.0.9    lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;
qsk-deploy-767d99b5c7-wh2rh   1/1     Running   0          32m   10.2.0.6    lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;</code></pre>
<p>If we change a number of replicas in the deployment file, newly pods will intelligently run on a newly recovered node so the distribution is maintained:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> scale <span class="at">--replicas</span> 10 deployment/qsk-deploy</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">-o</span> wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>NAME                          READY   STATUS    RESTARTS   AGE    IP          NODE                           NOMINATED NODE   READINESS GATES
qsk-deploy-679dc78b78-bgmfm   1/1     Running   0          14m    10.2.0.3    lke95373-144188-63fe9e5739a9   &lt;none&gt;           &lt;none&gt;
qsk-deploy-679dc78b78-ckvqx   1/1     Running   0          14m    10.2.0.5    lke95373-144188-63fe9e5739a9   &lt;none&gt;           &lt;none&gt;
qsk-deploy-679dc78b78-cvh5t   1/1     Running   0          2m6s   10.2.1.2    lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;
qsk-deploy-679dc78b78-gll5p   1/1     Running   0          2m6s   10.2.1.6    lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;
qsk-deploy-679dc78b78-hjsqx   1/1     Running   0          14m    10.2.0.6    lke95373-144188-63fe9e5739a9   &lt;none&gt;           &lt;none&gt;
qsk-deploy-679dc78b78-qs4gs   1/1     Running   0          14m    10.2.0.10   lke95373-144188-63fe9e5739a9   &lt;none&gt;           &lt;none&gt;
qsk-deploy-679dc78b78-r4kgl   1/1     Running   0          2m6s   10.2.1.5    lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;
qsk-deploy-679dc78b78-rqpgh   1/1     Running   0          2m6s   10.2.1.4    lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;
qsk-deploy-679dc78b78-vblz4   1/1     Running   0          14m    10.2.0.4    lke95373-144188-63fe9e5739a9   &lt;none&gt;           &lt;none&gt;
qsk-deploy-679dc78b78-x6f2g   1/1     Running   0          2m6s   10.2.1.3    lke95373-144188-63fe9e576608   &lt;none&gt;           &lt;none&gt;</code></pre>
<p><strong>Note: <code>kubectl scale</code> should not be used since there is a discrpancy between <code>deploy.yml</code> and new nubmer of replicas. The common practice is to always edit <code>deploy.yml</code> file and re-apply.</strong></p>
</section>
<section id="rolling-update" class="level1">
<h1>Rolling update</h1>
<p>We can apply rolling update if we add following lines to <code>deploy.yml</code>:</p>
<pre><code>  minReadySeconds: 20        &lt;== to wait for 20 seconds after updating each replica
  strategy:                  
    type: RollingUpdate      
    rollingUpdate:           
      maxSurge: 1         &lt;== allows Kubernetes to add one extra Pod during an update operation
      maxUnavailable: 0   &lt;== prevents Kubernetes from reducing the number of Pods during an update</code></pre>
<p>as well as update the version of the image:</p>
<pre><code>image: nesaboz/qsk-course:1.1      &lt;== this version must exists as an container on DockerHub</code></pre>
<p>so the <code>deploy.yml</code> looks like this:</p>
<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: qsk-deploy
spec:
  replicas: 5
  selector:
    matchLabels:
      project: diy
  minReadySeconds: 20        
  strategy:                  
    type: RollingUpdate      
    rollingUpdate:           
      maxSurge: 1            
      maxUnavailable: 0
  template:
    metadata:
      labels:
        project: diy
    spec: 
      containers:
      - name: qsk-pod
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
        image: nesaboz/qsk-course:1.1 </code></pre>
<p>Now if we re-apply deployment:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> deploy.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>deployment.apps/qsk-deploy configured</code></pre>
<p>we can monitor the rollout status:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> rollout status deployment qsk-deploy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="text"><code>Waiting for deployment "qsk-deploy" rollout to finish: 1 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 1 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 1 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 1 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 2 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 2 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 2 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 3 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 3 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 3 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 3 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 4 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 4 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 4 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 4 out of 5 new replicas have been updated...
Waiting for deployment "qsk-deploy" rollout to finish: 1 old replicas are pending termination...
Waiting for deployment "qsk-deploy" rollout to finish: 1 old replicas are pending termination...
Waiting for deployment "qsk-deploy" rollout to finish: 1 old replicas are pending termination...
deployment "qsk-deploy" successfully rolled out</code></pre>
<p>Soon, the App will be updated:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="10_kubernets_files/figure-html/f8c171cd-1-image-2.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image-2.png</figcaption><p></p>
</figure>
</div>
</section>
<section id="appendix-apply-service-locally" class="level1">
<h1>Appendix: Apply service locally</h1>
<p>For local application let’s use local <code>scv-local.yml</code> file:</p>
<pre><code>apiVersion: v1
kind: Service
metadata:
  name: svc-local
spec:
  type: NodePort    &lt;== this was LoadBalancer for cloud servers, now is NodePort
  ports:
  - port: 8080
    protocol: TCP       &lt;== this is a new line
    targetPort: 8080
    nodePort: 31111     &lt;== this is a new line
  selector:
    project: qsk-course    &lt;== this must match with the pod project</code></pre>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="nesaboz/blog" data-repo-id="R_kgDOI-Xebw" data-category="Announcements" data-category-id="DIC_kwDOI-Xeb84CUjh-" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
</div> <!-- /content -->



</body></html>